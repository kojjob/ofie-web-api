<% content_for :title, "Start Conversation" %>

<div class="min-h-screen bg-gray-50 py-8">
  <div class="max-w-2xl mx-auto px-4 sm:px-6 lg:px-8">
    <!-- Header -->
    <div class="mb-8">
      <h1 class="text-3xl font-bold text-gray-900 mb-2">Start a Conversation</h1>
      <% if @property %>
        <p class="text-gray-600">Send a message about: <span class="font-semibold"><%= @property.title %></span></p>
      <% end %>
    </div>

    <!-- Property Info Card (if property is specified) -->
    <% if @property %>
      <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-6 mb-8">
        <div class="flex items-start space-x-4">
          <% if @property.photos.attached? && @property.photos.any? %>
          <%= image_tag @property.photos.first, 
                class: "w-20 h-20 rounded-lg object-cover",
                alt: @property.title %>
          <% else %>
            <div class="w-20 h-20 bg-gray-200 rounded-lg flex items-center justify-center">
              <svg class="w-8 h-8 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-4m-5 0H9m0 0H5m0 0h2M7 7h10M7 11h10M7 15h10"></path>
              </svg>
            </div>
          <% end %>
          
          <div class="flex-1">
            <h3 class="text-lg font-semibold text-gray-900 mb-1"><%= @property.title %></h3>
            <p class="text-gray-600 mb-2"><%= @property.address %>, <%= @property.city %></p>
            <p class="text-2xl font-bold text-blue-600">$<%= number_with_delimiter(@property.price) %>/month</p>
          </div>
        </div>
      </div>
    <% end %>

    <!-- Conversation Form -->
    <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-6">
      <%= form_with model: @conversation, local: true, class: "space-y-6" do |form| %>
        <% if @property %>
          <%= hidden_field_tag :property_id, @property.id %>
        <% end %>

        <!-- Subject Field -->
        <div>
          <%= form.label :subject, class: "block text-sm font-medium text-gray-700 mb-2" do %>
            Subject <span class="text-red-500">*</span>
          <% end %>
          <%= form.text_field :subject, 
              class: "w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition duration-200",
              placeholder: @property ? "Question about #{@property.title}" : "What would you like to discuss?",
              required: true %>
        </div>

        <!-- Message Field -->
        <div>
          <%= form.label :initial_message, "Message", class: "block text-sm font-medium text-gray-700 mb-2" do %>
            Message <span class="text-red-500">*</span>
          <% end %>
          <%= text_area_tag :initial_message, "", 
              class: "w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition duration-200 resize-none",
              rows: 6,
              placeholder: @property ? "Hi! I'm interested in your property. Could you tell me more about..." : "Type your message here...",
              required: true %>
          <p class="mt-2 text-sm text-gray-500">Be specific about your questions or requirements.</p>
        </div>

        <!-- Action Buttons -->
        <div class="flex flex-col sm:flex-row gap-4 pt-4">
          <%= form.submit "Send Message", 
              class: "w-full sm:w-auto bg-blue-600 text-white py-3 px-6 rounded-lg font-semibold hover:bg-blue-700 focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition duration-200" %>
          
          <% if @property %>
            <%= link_to "Back to Property", @property, 
                class: "w-full sm:w-auto text-center border border-gray-300 text-gray-700 py-3 px-6 rounded-lg font-semibold hover:bg-gray-50 focus:ring-2 focus:ring-gray-500 focus:ring-offset-2 transition duration-200" %>
          <% else %>
            <%= link_to "Cancel", conversations_path, 
                class: "w-full sm:w-auto text-center border border-gray-300 text-gray-700 py-3 px-6 rounded-lg font-semibold hover:bg-gray-50 focus:ring-2 focus:ring-gray-500 focus:ring-offset-2 transition duration-200" %>
          <% end %>
        </div>
      <% end %>
    </div>

    <!-- Tips Section -->
    <div class="mt-8 bg-blue-50 rounded-xl p-6">
      <h3 class="text-lg font-semibold text-blue-900 mb-3">ðŸ’¡ Tips for effective communication</h3>
      <ul class="space-y-2 text-blue-800">
        <li class="flex items-start">
          <span class="text-blue-600 mr-2">â€¢</span>
          Be specific about your questions and requirements
        </li>
        <li class="flex items-start">
          <span class="text-blue-600 mr-2">â€¢</span>
          Include your preferred viewing times if interested
        </li>
        <li class="flex items-start">
          <span class="text-blue-600 mr-2">â€¢</span>
          Mention any special requirements or concerns
        </li>
        <li class="flex items-start">
          <span class="text-blue-600 mr-2">â€¢</span>
          Be respectful and professional in your communication
        </li>
      </ul>
    </div>
  </div>
</div>